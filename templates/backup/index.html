{% extends "base.html" %}
{% block content %}
<div class="module-wrap">
  <h2>๐๏ธ ูุงฺูู ุจฺฉุงูพ</h2>

  <div class="card">
    {% if last_auto_backup %}
      <strong>โฑ๏ธ ุขุฎุฑู ุจฺฉุงูพ ุฎูุฏฺฉุงุฑ:</strong>
      <span>{{ last_auto_backup }}</span>
    {% else %}
      <strong>โฑ๏ธ ุขุฎุฑู ุจฺฉุงูพ ุฎูุฏฺฉุงุฑ:</strong>
      <span>ุชุง ฺฉููู ุซุจุช ูุดุฏู ุงุณุช</span>
    {% endif %}
  </div>

  <div class="card">
    <h3>ุจฺฉุงูพ ฺฉุงูู</h3>
    <form method="post" action="{{ url_for('backup.create') }}">
      <input type="text" name="reason" placeholder="ุชูุถุญ (ุงุฎุชุงุฑ)" class="input">
      <button class="btn btn-primary">ุณุงุฎุช ุจฺฉุงูพ</button>
    </form>
  </div>

  <div class="card">
    <h3>ุณุงู ูุงู</h3>
    <p>ุดุฑูุน ูุนู: <b>{{ fiscal_year_start }}</b></p>

    {% if fiscal_years %}
      <form method="post" action="{{ url_for('backup.switch_year') }}">
        <label for="fiscal-year-select">ุงูุชุฎุงุจ ุณุงู ูุงู:</label>
        <select id="fiscal-year-select" name="year" class="input">
          {% for year in fiscal_years %}
            <option value="{{ year.start }}" {% if year.start == fiscal_year_start %}selected{% endif %}>{{ year.label }}</option>
          {% endfor %}
        </select>
        <button class="btn">ุงุนูุงู</button>
      </form>
    {% else %}
      <p class="muted">ูููุฒ ุณุงู ูุงู ุซุจุช ูุดุฏู ุงุณุช.</p>
    {% endif %}

    <hr>

    <form method="post" action="{{ url_for('backup.new_year') }}" onsubmit="return confirm('ุจฺฉุงูพ ฺฏุฑูุชู ูโุดูุฏ ู ุณุงู ูุงู ุฌุฏุฏ ุงุนูุงู ูโฺฏุฑุฏุฏ. ุงุฏุงููุ');">
      <label for="fiscal-year-start">ุดุฑูุน ุณุงู ูุงู ุฌุฏุฏ:</label>
      <input type="date" id="fiscal-year-start" name="start_date" required class="input">
      <button class="btn">ุดุฑูุน ุณุงู ูุงู ุฌุฏุฏ</button>
    </form>
  </div>

  <div class="card">
    <h3>ููุฑุณุช ุจฺฉุงูพโูุง</h3>
    <table class="table">
      <thead><tr><th>ูุงู ูุงู</th><th>ุญุฌู</th><th>ุชุงุฑุฎ</th><th class="center">ุงูุฏุงูุงุช</th></tr></thead>
      <tbody>
        {% for b in backups %}
        <tr>
          <td>{{ b.name }}</td>
          <td>{{ "{:,}".format(b.size) }} bytes</td>
          <td>{{ b.mtime }}</td>
          <td class="center">
            <div class="ops">
              <a class="btn btn-small" href="{{ url_for('backup.download', name=b.name) }}">ุฏุงูููุฏ</a>
              <form method="post" action="{{ url_for('backup.restore') }}"
                    onsubmit="return confirm('ุฑโุงุณุชูุฑ ุงู ูุงู ุงูุฌุงู ุดูุฏุ (ูพุณ ุงุฒ ุขู ุฑโุงุณุชุงุฑุช ุณุฑูุณ ูุงุฒู ุงุณุช)');">
                <input type="hidden" name="name" value="{{ b.name }}">
                <button class="btn btn-small btn-danger" type="submit">ุฑโุงุณุชูุฑ</button>
              </form>
            </div>
          </td>
        </tr>
        {% else %}
        <tr><td colspan="4">ูฺ ุจฺฉุงูพ ุงูุช ูุดุฏ.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
