<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ title or "hesab pak" }}</title>
  <link rel="stylesheet" href="{{ prefix }}/static/style.css">
  <link rel="stylesheet" href="{{ prefix }}/static/search.css">
  {% block head_extra %}{% endblock %}

  <!-- Ù…Ù‚Ø¯Ø§Ø± prefix Ø±Ø§ Ø§Ù…Ù† Ø¨Ù‡ JS Ø¨Ø¯Ù‡Ø› Ø§Ú¯Ø± ØªÙ‡ÛŒ Ø¨ÙˆØ¯ "" -->
  <script>
    (function(){
      var p = {{ (prefix or "")|tojson|safe }};
      // Ù‡Ø± Ø­Ø§Ù„Øª Ø®Ø±Ø§Ø¨ Ø±Ø§ Ø®Ù†Ø«ÛŒ Ú©Ù†
      if(!p || p === "undefined" || p === "/undefined") p = "";
      // Ù†Ú¯Ø°Ø§Ø±ÛŒÙ… Ø§Ø³Ù„Ø´ Ø§Ø¶Ø§ÙÙ‡/Ú©Ù… Ø¨ÛŒÙØªØ¯
      if(p.endsWith("/")) p = p.replace(/\/+$/,"");
      window.APP_PREFIX = p;
    })();
  </script>
  <script>
  window.IS_ADMIN = {{ 'true' if is_admin else 'false' }};
  window.USER_PERMISSIONS = {{ (user_permissions or [])|tojson|safe }};
  </script>
  <script defer src="{{ prefix }}/static/search-unified.js?v=2"></script>
  <script defer src="{{ prefix }}/static/search-ajax.js?v=2"></script>

</head>
<body class="theme-{{ active_theme }}" data-active-theme="{{ active_theme }}" data-search-sort="{{ search_sort_pref }}" data-price-mode="{{ price_display_mode }}">
<header class="topbar">
  <div class="brand">Ø­Ø³Ø§Ø¨ Ù¾Ø§Ú© <span class="en">hesab pak</span></div>
  <div class="clock" id="top-clock" data-live-clock data-jalali="{{ now_info['jalali_date'] }}">
    <span class="icon">â°</span>
    <span class="time" data-role="time">--:--:--</span>
    <span class="sep">|</span>
    <span class="date" data-role="date">{{ now_info['jalali_date']|fa_digits }}</span>
  </div>
  <div class="who">
    {% if current_user.is_authenticated %}
      <span>Ú©Ø§Ø±Ø¨Ø±: {{ logged_username }}</span>
      <span class="sep">|</span>
      <span>Ù…Ø¯Øª ÙØ¹Ø§Ù„ÛŒØª: {{ login_duration }}</span>
      <span class="sep">|</span>
      <a class="logout" href="{{ prefix }}/logout">Ø®Ø±ÙˆØ¬</a>
    {% endif %}
  </div>
</header>
<!-- top quick-menu removed per user request; pages will use .module-wrap under the global search -->

<!-- Ù†ÙˆØ§Ø± Ø¬Ø³Øªâ€ŒÙˆØ¬ÙˆÛŒ Ø³Ø±Ø§Ø³Ø±ÛŒ -->
<div class="search-wrap global-search" data-ajax="1">
  <div class="global-search-inputs" style="display:flex; gap:8px; align-items:center;">
    <input id="global-search" class="search-inp" type="text" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø± Ø§Ø³Ø§Ø³ Ú©Ø¯ ÛŒØ§ Ù†Ø§Ù…..." autocomplete="off">
    <select id="global-kind" class="search-inp" style="max-width:140px;height:44px;">
      <option value="">Ù‡Ù…Ù‡</option>
      <option value="item">Ú©Ø§Ù„Ø§</option>
      <option value="person">Ø´Ø®Øµ</option>
      <option value="cheque">Ú†Ú©</option>
    </select>
    <select id="global-sort" class="search-inp" style="max-width:160px;height:44px;">
      {% for value,label in search_sort_choices %}
      <option value="{{ value }}" {% if value == search_sort_pref %}selected{% endif %}>Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ: {{ label }}</option>
      {% endfor %}
    </select>
  </div>

  <div id="global-results" class="search-results" hidden></div>


  {# Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø§Ø² Ø±ÙˆÛŒ Ø³Ø±Ú† Ø­Ø°Ù Ø´Ø¯Ø› Ù„ÛŒÙ†Ú© Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø§Ú©Ù†ÙˆÙ† Ø¯Ø± Ù…Ù†ÙˆÙ‡Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ #}
</div>

<!-- quick shortcuts removed â€” single top menu used instead -->


<!-- TOP MENUS: full set shown above the dashboard; dashboard link included -->
<nav class="top-menus" aria-label="main-menu">
  <div class="top-menus-inner">
    {% set perms = user_permissions or [] %}
    <a class="menu-item" href="{{ prefix }}/"><span class="icon">ğŸ </span><span class="label">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</span></a>
    {# Invoices / Sales / Purchase #}
    <a class="menu-item" href="{{ prefix }}/invoice?kind=sales"><span class="icon">ğŸ§¾</span><span class="label">ÙØ§Ú©ØªÙˆØ± ÙØ±ÙˆØ´ Ø¬Ø¯ÛŒØ¯</span></a>
    <a class="menu-item" href="{{ prefix }}/invoice?kind=purchase"><span class="icon">ğŸ“¥</span><span class="label">ÙØ§Ú©ØªÙˆØ± Ø®Ø±ÛŒØ¯ Ø¬Ø¯ÛŒØ¯</span></a>
    {# Entities: items / persons #}
    <a class="menu-item" href="{{ prefix }}/entities?kind=item"><span class="icon">ğŸ“¦</span><span class="label">Ú©Ø§Ù„Ø§Ù‡Ø§</span></a>
    <a class="menu-item" href="{{ prefix }}/entities?kind=person"><span class="icon">ğŸ‘¥</span><span class="label">Ø§Ø´Ø®Ø§Øµ</span></a>
    {# Cash: receive / payment #}
    <a class="menu-item" href="{{ prefix }}/cash_doc?kind=receive"><span class="icon">â•</span><span class="label">Ø¯Ø±ÛŒØ§ÙØª</span></a>
    <a class="menu-item" href="{{ prefix }}/cash_doc?kind=payment"><span class="icon">â–</span><span class="label">Ù¾Ø±Ø¯Ø§Ø®Øª</span></a>
    {# Reports and Settings #}
    <a class="menu-item" href="{{ prefix }}/reports"><span class="icon">ğŸ“Š</span><span class="label">Ú¯Ø²Ø§Ø±Ø´Ø§Øª</span></a>
    <a class="menu-item" href="{{ prefix }}/settings"><span class="icon">âš™ï¸</span><span class="label">ØªÙ†Ø¸ÛŒÙ…Ø§Øª</span></a>
    {# Admin and Assistant (show if permitted) #}
    {% if 'assistant' in perms %}
      <a class="menu-item" href="{{ prefix }}/assistant"><span class="icon">ğŸ¤–</span><span class="label">Ø¯Ø³ØªÛŒØ§Ø±</span></a>
    {% endif %}
    {% if 'admin' in perms %}
      <a class="menu-item" href="{{ prefix }}/admin"><span class="icon">ğŸ—„ï¸</span><span class="label">Ù…Ø¯ÛŒØ±ÛŒØª</span></a>
    {% endif %}
  </div>
</nav>


<!-- Ø§ÙˆÙ„: Ù…Ø­ØªÙˆØ§ÛŒ Ù…Ø§Ú˜ÙˆÙ„ ØµÙØ­Ù‡ -->
<div class="module-wrap">
  <main class="container">
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for cat,msg in messages %}<div class="flash {{cat}}">{{ msg }}</div>{% endfor %}
    {% endif %}
  {% endwith %}
  {% block content %}{% endblock %}
  </main>
</div>

<!-- Ø¨Ø¹Ø¯: Ù…Ù†ÙˆÙ‡Ø§ÛŒ Ø¹Ù…ÙˆØ¯ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ÛŒ -->
{# Bottom mobile menu removed per user request â€” full dashboard menus are shown in the main UI instead #}

<footer class="footer">Â© 2025 hesab pak</footer>

<script src="{{ prefix }}/static/app.js"></script>
{% block body_scripts %}{% endblock %}
</body>
</html>
