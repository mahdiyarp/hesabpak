<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ title or "hesab pak" }}</title>
  <link rel="stylesheet" href="{{ prefix }}/static/style.css">
  <link rel="stylesheet" href="{{ prefix }}/static/search.css">
  {% block head_extra %}{% endblock %}

  <!-- Ù…Ù‚Ø¯Ø§Ø± prefix Ø±Ø§ Ø§Ù…Ù† Ø¨Ù‡ JS Ø¨Ø¯Ù‡Ø› Ø§Ú¯Ø± ØªÙ‡ÛŒ Ø¨ÙˆØ¯ "" -->
  <script>
    (function(){
      var p = {{ (prefix or "")|tojson }};
      // Ù‡Ø± Ø­Ø§Ù„Øª Ø®Ø±Ø§Ø¨ Ø±Ø§ Ø®Ù†Ø«ÛŒ Ú©Ù†
      if(!p || p === "undefined" || p === "/undefined") p = "";
      // Ù†Ú¯Ø°Ø§Ø±ÛŒÙ… Ø§Ø³Ù„Ø´ Ø§Ø¶Ø§ÙÙ‡/Ú©Ù… Ø¨ÛŒÙØªØ¯
      if(p.endsWith("/")) p = p.replace(/\/+$/,"");
      window.APP_PREFIX = p;
    })();
  </script>
  <script>
  window.IS_ADMIN = {{ 'true' if is_admin else 'false' }};
  </script>
  <script defer src="{{ prefix }}/static/search-unified.js"></script>

</head>
<body>
<header class="topbar">
  <div class="brand">Ø­Ø³Ø§Ø¨ Ù¾Ø§Ú© <span class="en">hesab pak</span></div>
  <div class="clock" id="top-clock" data-live-clock data-jalali="{{ now_info['jalali_date'] }}">
    <span class="icon">â°</span>
    <span class="time" data-role="time">--:--:--</span>
    <span class="sep">|</span>
    <span class="date" data-role="date">{{ now_info['jalali_date'] }}</span>
  </div>
  <div class="who">
    {% if current_user.is_authenticated %}
      <span>Ú©Ø§Ø±Ø¨Ø±: {{ logged_username }}</span>
      <span class="sep">|</span>
      <span>Ù…Ø¯Øª ÙØ¹Ø§Ù„ÛŒØª: {{ login_duration }}</span>
      <span class="sep">|</span>
      <a class="logout" href="{{ prefix }}/logout">Ø®Ø±ÙˆØ¬</a>
    {% endif %}
  </div>
</header>

<!-- Ù†ÙˆØ§Ø± Ø¬Ø³Øªâ€ŒÙˆØ¬ÙˆÛŒ Ø³Ø±Ø§Ø³Ø±ÛŒ -->
<div class="search-wrap global-search">
  <div class="global-search-inputs" style="display:flex; gap:8px; align-items:center;">
    <input id="global-search" class="search-inp" type="text" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø± Ø§Ø³Ø§Ø³ Ú©Ø¯ ÛŒØ§ Ù†Ø§Ù…..." autocomplete="off">
    <select id="global-kind" class="search-inp" style="max-width:140px;height:44px;">
      <option value="">Ù‡Ù…Ù‡</option>
      <option value="item">Ú©Ø§Ù„Ø§</option>
      <option value="person">Ø´Ø®Øµ</option>
      <option value="cheque">Ú†Ú©</option>
    </select>
  </div>

  <div id="global-results" class="search-results" hidden></div>
  <div id="global-actions" class="search-actions" hidden></div>


  {% if request.path != (prefix + '/' if prefix else '/') %}
  <div class="dashboard-return">
    <a class="btn back-dashboard" href="{{ prefix }}/">â† Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</a>
  </div>
  {% endif %}
</div>


<!-- Ø§ÙˆÙ„: Ù…Ø­ØªÙˆØ§ÛŒ Ù…Ø§Ú˜ÙˆÙ„ ØµÙØ­Ù‡ -->
<main class="container">
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for cat,msg in messages %}<div class="flash {{cat}}">{{ msg }}</div>{% endfor %}
    {% endif %}
  {% endwith %}
  {% block content %}{% endblock %}
</main>

<!-- Ø¨Ø¹Ø¯: Ù…Ù†ÙˆÙ‡Ø§ÛŒ Ø¹Ù…ÙˆØ¯ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ÛŒ -->
<nav class="mobile-menu" style="padding:0 12px;">
  <a class="menu-item" href="{{ prefix }}/sales"><span class="icon">ğŸ§¾</span><span class="label">ÙØ±ÙˆØ´</span><span class="chev">â€º</span></a>
  <a class="menu-item" href="{{ prefix }}/receive"><span class="icon">â•</span><span class="label">Ø¯Ø±ÛŒØ§ÙØª</span><span class="chev">â€º</span></a>
  <a class="menu-item" href="{{ prefix }}/purchase"><span class="icon">ğŸ›’</span><span class="label">Ø®Ø±ÛŒØ¯</span><span class="chev">â€º</span></a>
  <a class="menu-item" href="{{ prefix }}/payment"><span class="icon">â–</span><span class="label">Ù¾Ø±Ø¯Ø§Ø®Øª</span><span class="chev">â€º</span></a>
  <a class="menu-item" href="{{ prefix }}/reports"><span class="icon">ğŸ“Š</span><span class="label">Ú¯Ø²Ø§Ø±Ø´Ø§Øª</span><span class="chev">â€º</span></a>
  <a class="menu-item" href="{{ prefix }}/entities?kind=item"><span class="icon">â•</span><span class="label">Ø«Ø¨Øª Ø´Ø®Øµ ÛŒØ§ Ú©Ø§Ù„Ø§ Ø¬Ø¯ÛŒØ¯</span><span class="chev">â€º</span></a>
  {% if is_admin %}
  <a class="menu-item" href="{{ prefix }}/admin"><span class="icon">ğŸ—„ï¸</span><span class="label">Ù…Ø¯ÛŒØ±ÛŒØª</span><span class="chev">â€º</span></a>
  {% endif %}
</nav>

<footer class="footer">Â© 2025 hesab pak</footer>

<script src="{{ prefix }}/static/app.js"></script>
{% block body_scripts %}{% endblock %}
</body>
</html>
