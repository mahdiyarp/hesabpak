{% extends "base.html" %}

{% block content %}
<div class="module-wrap admin-dashboard">
  <h2>๐๏ธ ูุฏุฑุช ุณุงูุงูู</h2>
  <p class="muted" style="margin: 0 0 16px;">
    ุงุฒ ุงู ุจุฎุด ูโุชูุงูุฏ ุชูุธูุงุช ุญุงุช ุณุงูุงููุ ูุฑุขูุฏูุง ุจฺฉุงูพ ู ุงุจุฒุงุฑูุง ูู ุฑุง ฺฉูุชุฑู ฺฉูุฏ.
  </p>

  <div class="admin-grid">
    <a class="admin-card" href="{{ url_for('admin_users') }}">
      <div class="admin-card__icon">๐ฅ</div>
      <div class="admin-card__body">
        <h3>ฺฉุงุฑุจุฑุงู ู ุณุทูุญ ุฏุณุชุฑุณ</h3>
        <p>ุงุฌุงุฏุ ูุฑุงุดุ ุบุฑูุนุงูโุณุงุฒ ู ุชุนู ูุฌูุฒูุง ุฏุณุชุฑุณ ฺฉุงุฑุจุฑุงู ุณุงูุงูู.</p>
      </div>
      <div class="admin-card__chev">โบ</div>
    </a>

    <a class="admin-card" href="{{ url_for('admin_cashboxes') }}">
      <div class="admin-card__icon">๐ฆ</div>
      <div class="admin-card__body">
        <h3>ุตูุฏููโูุง ู ุญุณุงุจโูุง</h3>
        <p>ูุฏุฑุช ุตูุฏููโูุง ููุฏ ู ุญุณุงุจโูุง ุจุงูฺฉ ุฌูุช ุงุณุชูุงุฏู ุฏุฑ ุฏุฑุงูุช ู ูพุฑุฏุงุฎุช.</p>
      </div>
      <div class="admin-card__chev">โบ</div>
    </a>

    <a class="admin-card" href="{{ prefix }}/settings">
      <div class="admin-card__icon">โ๏ธ</div>
      <div class="admin-card__body">
        <h3>ุชูุธูุงุช</h3>
        <p>ูพฺฉุฑุจูุฏ ุฏุณุชฺฏุงู ฺฉุงุฑุชุฎูุงู ู ุณุงุฑ ุชูุธูุงุช ูุฏุฑุช ุณุงูุงูู.</p>
      </div>
      <div class="admin-card__chev">โบ</div>
    </a>

    <a class="admin-card" href="{{ url_for('backup.index') }}">
      <div class="admin-card__icon">๐๏ธ</div>
      <div class="admin-card__body">
        <h3>ุจฺฉุงูพ ู ุณุงู ูุงู</h3>
        <p>ุณุงุฎุช ู ูุฏุฑุช ุจฺฉุงูพโูุงุ ุจุงุฒุงุจ ุงุทูุงุนุงุช ู ุดุฑูุน ุณุงู ูุงู ุฌุฏุฏ.</p>
      </div>
      <div class="admin-card__chev">โบ</div>
    </a>

    <a class="admin-card" href="{{ prefix }}/developer">
      <div class="admin-card__icon">๐งโ๐ป</div>
      <div class="admin-card__body">
        <h3>ุงุจุฒุงุฑ ุชูุณุนูโุฏููุฏู</h3>
        <p>ุงุฌุฑุง ุงุณฺฉุฑูพุชโูุง ูพุดุชุจุงู ู ุจุฑุฑุณ ูุถุนุช ูู ุณุณุชู.</p>
      </div>
      <div class="admin-card__chev">โบ</div>
    </a>

    <a class="admin-card" href="{{ prefix }}/assistant">
      <div class="admin-card__icon">๐ค</div>
      <div class="admin-card__body">
        <h3>ุฏุณุชุงุฑ ููุดููุฏ</h3>
        <p>ุซุจุช ุฎูุฏฺฉุงุฑ ูุงฺฉุชูุฑ ุงุฒ ุทุฑู ููุด ูุตููุน ู ุดูุงุณุง ุงููุงู ุงุฒ ุฑู ุชุตูุฑ.</p>
      </div>
      <div class="admin-card__chev">โบ</div>
    </a>

    <div class="admin-card" id="admin-update-card" style="cursor:default">
      <div class="admin-card__icon">โฌ๏ธ</div>
      <div class="admin-card__body">
        <h3>ุขูพุฏุช ุงุฒ ฺฏุชโูุงุจ</h3>
        <p>ุขูพุฏุช ฺฉุฏ ุงุฒ ูุฎุฒู ุฑุณู (ููุท ุจุฑุง ูุฏุฑุงู). ูุจู ุงุฒ ุงุฌุฑุง ุงู ุนููุงุช ุงุฒ ุฐุฎุฑูโุณุงุฒ ูุญู ุงุทููุงู ุญุงุตู ฺฉูุฏ.</p>
        <div style="margin-top:8px">
          <button id="btn-update-from-git" class="btn">ุงุฌุฑุง ุขูพุฏุช</button>
          <span id="update-status" style="margin-left:12px;color:#666"></span>
        </div>
      </div>
      <div class="admin-card__chev">โบ</div>
    </div>

    <a class="admin-card" href="{{ prefix }}/admin/ledger">
      <div class="admin-card__icon">๐</div>
      <div class="admin-card__body">
        <h3>ุฏูุชุฑ ุซุจุช (Ledger)</h3>
        <p>ูุดุงูุฏูู ุฒูุฌุฑูู ูุฑูุฏูุง ุซุจุชโุดุฏู ุจุฑุง ุฑุฏุงุจู ุชุบุฑุงุช (append-only).</p>
      </div>
      <div class="admin-card__chev">โบ</div>
    </a>
  </div>
</div>
{% endblock %}

  {% block scripts %}
    <script>
      (function(){
        const btn = document.getElementById('btn-update-from-git');
        const status = document.getElementById('update-status');
        if (!btn) return;
        btn.addEventListener('click', async function(){
          if (!confirm('ุขุง ูุตุฏ ุฏุงุฑุฏ ูุฎุฒู ุฑุณู ุฑุง ุงุฒ GitHub ุฏุฑุงูุช ู ุจุฑูุงูู ุฑุง ุจูโุฑูุฒ ฺฉูุฏุ ุนููุงุช ููฺฉู ุงุณุช ุจุงุนุซ ุฑุงูโุงูุฏุงุฒ ูุฌุฏุฏ ุณุฑูุณ ุดูุฏ.')) return;
          btn.disabled = true; status.textContent = 'ุฏุฑ ุญุงู ุงุฌุฑุง...';
          try{
            const resp = await fetch('{{ prefix }}/admin/update_from_git', {method:'POST', credentials:'same-origin', headers:{'X-Requested-With':'XMLHttpRequest'}});
            const data = await resp.json();
            if (resp.ok && data.ok){
              status.textContent = 'ุขูพุฏุช ุจุง ููููุช ุงูุฌุงู ุดุฏ';
              alert('ุขูพุฏุช ุจุง ููููุช ุงูุฌุงู ุดุฏ. ูุทูุงู ูุงฺฏโูุง ุฑุง ุจุฑุฑุณ ฺฉูุฏ.');
            } else {
              status.textContent = 'ุฎุทุง ุฏุฑ ุขูพุฏุช';
              alert('ุฎุทุง: ' + (data.steps ? JSON.stringify(data.steps, null, 2) : resp.statusText));
            }
          }catch(err){
            console.error(err);
            status.textContent = 'ุฎุทุง ุดุจฺฉู';
            alert('ุฎุทุง ุดุจฺฉู ุง ุฏุฑุฎูุงุณุช ูุงูุนุชุจุฑ. ฺฉูุณูู ูุฑูุฑฺฏุฑ ุฑุง ุจุจูุฏ.');
          } finally { btn.disabled = false; }
        });
      })();
    </script>
  {% endblock %}
