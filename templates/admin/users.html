{% extends "base.html" %}
{% block content %}
<div class="module-wrap admin-users">
  <h2>ğŸ‘¥ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</h2>
  <p class="muted" style="margin-bottom:18px;">
    Ø¯Ø± Ø§ÛŒÙ† ØµÙØ­Ù‡ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¬Ø¯ÛŒØ¯ Ø¨Ø³Ø§Ø²ÛŒØ¯ØŒ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± ÛŒØ§ Ù†Ù‚Ø´ Ø¢Ù†Ø§Ù† Ø±Ø§ ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯ Ùˆ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±Ø§ Ú©Ù†ØªØ±Ù„ Ú©Ù†ÛŒØ¯.
  </p>

  <div class="card" style="margin-bottom:24px;">
    <h3 style="margin-top:0;">Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø«Ø¨Øªâ€ŒØ´Ø¯Ù‡</h3>
    {% if users %}
    <div class="table-wrapper">
      <table class="admin-users-table">
        <thead>
          <tr>
            <th>Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</th>
            <th>Ù†Ù‚Ø´</th>
            <th>Ù…Ø¬ÙˆØ²Ù‡Ø§</th>
            <th>ÙØ¹Ø§Ù„ØŸ</th>
            <th>Ø±Ù…Ø² Ø¬Ø¯ÛŒØ¯</th>
            <th>Ø§Ù‚Ø¯Ø§Ù…Ø§Øª</th>
          </tr>
        </thead>
        <tbody>
          {% for user in users %}
          <tr>
            <form method="post" class="user-row-form" style="display: contents;">
              <input type="hidden" name="username" value="{{ user.username }}">
              <input type="hidden" name="action" value="update">
              <td data-title="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ">
                <strong>{{ user.username }}</strong>
                {% if user.username == logged_username %}
                <span class="tag">Ø´Ù…Ø§</span>
                {% endif %}
              </td>
              <td data-title="Ù†Ù‚Ø´">
                <select class="inp" name="role" {% if user.username == admin_username %}disabled{% endif %}>
                  {% for role_key, role_label in role_labels.items() %}
                  <option value="{{ role_key }}" {% if role_key == user.role %}selected{% endif %} {% if user.username == admin_username and role_key != 'admin' %}disabled{% endif %}>{{ role_label }}</option>
                  {% endfor %}
                </select>
              </td>
              <td data-title="Ù…Ø¬ÙˆØ²Ù‡Ø§">
                <div class="perm-grid">
                  {% for perm in assignable_permissions %}
                  <label class="perm-item">
                    <input type="checkbox" name="permissions" value="{{ perm }}" {% if perm in user.permissions %}checked{% endif %} {% if user.username == admin_username %}disabled{% endif %}>
                    <span>{{ permission_labels[perm] }}</span>
                  </label>
                  {% endfor %}
                  {% if user.username != admin_username and 'admin' in user.permissions %}
                  <input type="hidden" name="permissions" value="admin">
                  {% endif %}
                </div>
              </td>
              <td data-title="ÙˆØ¶Ø¹ÛŒØª">
                <label class="switch">
                  <input type="checkbox" name="is_active" value="1" {% if user.is_active %}checked{% endif %} {% if user.username == admin_username %}disabled{% endif %}>
                  <span class="slider"></span>
                </label>
              </td>
              <td data-title="Ø±Ù…Ø² Ø¬Ø¯ÛŒØ¯">
                <input class="inp" type="password" name="password" placeholder="Ø§Ø®ØªÛŒØ§Ø±ÛŒ">
              </td>
              <td class="actions" data-title="Ø§Ù‚Ø¯Ø§Ù…Ø§Øª">
                <div class="btn-group">
                  <button class="btn btn-primary" type="submit">Ø°Ø®ÛŒØ±Ù‡</button>
                  {% if user.username != admin_username %}
                  <button class="btn btn-danger" type="submit" name="action" value="delete" onclick="return confirm('Ú©Ø§Ø±Ø¨Ø± {{ user.username }} Ø­Ø°Ù Ø´ÙˆØ¯ØŸ');">Ø­Ø°Ù</button>
                  {% endif %}
                </div>
              </td>
            </form>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="empty-state">Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>
    {% endif %}
  </div>

  <div class="card">
    <h3 style="margin-top:0;">Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯</h3>
    <form method="post" class="create-user-form">
      <input type="hidden" name="action" value="create">
      <div class="form-grid">
        <label>
          <span>Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</span>
          <input class="inp" type="text" name="username" required>
        </label>
        <label>
          <span>Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</span>
          <input class="inp" type="password" name="password" required>
        </label>
        <label>
          <span>ØªÚ©Ø±Ø§Ø± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</span>
          <input class="inp" type="password" name="password_confirm" required>
        </label>
        <label>
          <span>Ù†Ù‚Ø´</span>
          <select class="inp" name="role">
            {% for role_key, role_label in role_labels.items() %}
            <option value="{{ role_key }}" {% if role_key == 'staff' %}selected{% endif %}>{{ role_label }}</option>
            {% endfor %}
          </select>
        </label>
        <label class="toggle">
          <input type="checkbox" name="is_active" value="1" checked>
          <span>ÙØ¹Ø§Ù„ Ø¨Ø§Ø´Ø¯</span>
        </label>
      </div>

      <div class="perm-grid" style="margin-top:16px;">
        {% for perm in assignable_permissions %}
        <label class="perm-item">
          <input type="checkbox" name="permissions" value="{{ perm }}" checked>
          <span>{{ permission_labels[perm] }}</span>
        </label>
        {% endfor %}
      </div>

      <div class="form-actions">
        <button class="btn btn-primary" type="submit">Ø°Ø®ÛŒØ±Ù‡ Ú©Ø§Ø±Ø¨Ø±</button>
      </div>
    </form>
  </div>
</div>
{% endblock %}
