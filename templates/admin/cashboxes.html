{% extends "base.html" %}
{% block content %}
<div class="module-wrap">
  <h2>๐ฆ ูุฏุฑุช ุตูุฏููโูุง ู ุญุณุงุจโูุง</h2>
  <p class="muted" style="margin-top:-4px;margin-bottom:18px;">ุตูุฏููโูุง ููุฏ ู ุญุณุงุจโูุง ุจุงูฺฉ ุฏุฑ ูุฑูโูุง ุฏุฑุงูุช ู ูพุฑุฏุงุฎุช ูุงุจู ุงูุชุฎุงุจ ูุณุชูุฏ.</p>

  <div class="card" style="display:block;">
    <h3 style="margin-top:0;">ุซุจุช ุตูุฏูู ุฌุฏุฏ</h3>
    <form method="post" class="cashbox-form" style="display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));align-items:end;">
      <div>
        <label class="lbl" for="name">ูุงู ุตูุฏูู/ุญุณุงุจ</label>
        <input class="inp" id="name" name="name" placeholder="ูุซูุงู ุตูุฏูู ุงุตู ุง ุจุงูฺฉ ููุช">
      </div>
      <div>
        <label class="lbl" for="kind">ููุน</label>
        <select class="inp" id="kind" name="kind">
          <option value="cash">ููุฏ</option>
          <option value="bank">ุจุงูฺฉ</option>
        </select>
      </div>
      <div data-bank-only>
        <label class="lbl" for="bank_name">ูุงู ุจุงูฺฉ</label>
        <input class="inp" id="bank_name" name="bank_name" placeholder="ูุซูุงู ููุช" />
      </div>
      <div data-bank-only>
        <label class="lbl" for="account_no">ุดูุงุฑู ุญุณุงุจ</label>
        <input class="inp" id="account_no" name="account_no" placeholder="ุดูุงุฑู ุญุณุงุจ ุง ฺฉุงุฑุช" />
      </div>
      <div data-bank-only>
        <label class="lbl" for="iban">ุดุจุง (ุงุฎุชุงุฑ)</label>
        <input class="inp" id="iban" name="iban" placeholder="IR...">
      </div>
      <div>
        <label class="lbl" for="description">ุชูุถุญุงุช</label>
        <input class="inp" id="description" name="description" placeholder="ุชูุถุญ ฺฉูุชุงู ุง ุขุฏุฑุณ ุดุนุจู">
      </div>
      <div style="display:flex;gap:10px;">
        <button class="btn btn-primary" type="submit">ุงูุฒูุฏู ุตูุฏูู</button>
      </div>
    </form>
  </div>

  <div class="card" style="display:block;margin-top:18px;">
    <h3 style="margin-top:0;">ูุณุช ุตูุฏููโูุง</h3>
    {% if boxes %}
    <div class="table-responsive">
      <table class="table">
        <thead>
          <tr>
            <th>ูุงู</th>
            <th>ููุน</th>
            <th>ุจุงูฺฉ</th>
            <th>ุดูุงุฑู ุญุณุงุจ/ฺฉุงุฑุช</th>
            <th>ูุถุนุช</th>
            <th class="center">ุนููุงุช</th>
          </tr>
        </thead>
        <tbody>
          {% for box in boxes %}
          <tr class="{{ 'muted' if not box.is_active else '' }}">
            <td>{{ box.name }}</td>
            <td>{{ 'ุจุงูฺฉ' if box.kind=='bank' else 'ููุฏ' }}</td>
            <td>{{ box.bank_name or 'โ' }}</td>
            <td class="ltr">{{ box.account_no or 'โ' }}</td>
            <td>{{ 'ูุนุงู' if box.is_active else 'ุบุฑูุนุงู' }}</td>
            <td class="center">
              {% if box.is_active %}
              <form method="post" action="{{ url_for('admin_cashboxes_delete', box_id=box.id) }}" onsubmit="return confirm('ุญุฐู ุง ุบุฑูุนุงูโุณุงุฒ ุงู ุตูุฏูู ุงูุฌุงู ุดูุฏุ');" style="display:inline-block;">
                <button class="btn danger" type="submit" style="padding:6px 12px;">ุญุฐู/ุบุฑูุนุงู</button>
              </form>
              {% else %}
                <span class="muted">โ</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <p class="muted" style="font-size:12px;margin-top:10px;">ุฏุฑ ุตูุฑุช ุงุณุชูุงุฏู ุตูุฏูู ุฏุฑ ุงุณูุงุฏ ฺฏุฐุดุชูุ ุญุฐู ูุฒฺฉ ุงูุฌุงู ููโุดูุฏ ู ุตูุฏูู ุบุฑูุนุงู ูโฺฏุฑุฏุฏ.</p>
    {% else %}
      <div class="muted">ูููุฒ ุตูุฏูู ุซุจุช ูุดุฏู ุงุณุช.</div>
    {% endif %}
  </div>
</div>
{% endblock %}

{% block body_scripts %}
{{ super() }}
<script>
(function(){
  const kind = document.getElementById('kind');
  const bankFields = document.querySelectorAll('[data-bank-only]');
  function sync(){
    const isBank = kind && kind.value === 'bank';
    bankFields.forEach(wrap => {
      const input = wrap.querySelector('input');
      if(isBank){
        wrap.style.display = '';
        if(input) input.disabled = false;
      }else{
        wrap.style.display = 'none';
        if(input){ input.value=''; input.disabled = true; }
      }
    });
  }
  if(kind){
    sync();
    kind.addEventListener('change', sync);
  }
})();
</script>
{% endblock %}
