{% extends "base.html" %}
{% block content %}
<div class="module-wrap">
  <h2>ğŸ¦ Ù…Ø¯ÛŒØ±ÛŒØª ØµÙ†Ø¯ÙˆÙ‚â€ŒÙ‡Ø§ Ùˆ Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§</h2>
  <p class="muted" style="margin-top:-4px;margin-bottom:18px;">ØµÙ†Ø¯ÙˆÙ‚â€ŒÙ‡Ø§ÛŒ Ù†Ù‚Ø¯ÛŒ Ùˆ Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ù†Ú©ÛŒ Ø¯Ø± ÙØ±Ù…â€ŒÙ‡Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ùˆ Ù¾Ø±Ø¯Ø§Ø®Øª Ù‚Ø§Ø¨Ù„ Ø§Ù†ØªØ®Ø§Ø¨ Ù‡Ø³ØªÙ†Ø¯.</p>

  <div class="card" style="display:block;">
    <h3 style="margin-top:0;">Ø«Ø¨Øª ØµÙ†Ø¯ÙˆÙ‚ Ø¬Ø¯ÛŒØ¯</h3>
    <form method="post" class="cashbox-form" style="display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));align-items:end;">
      <div>
        <label class="lbl" for="name">Ù†Ø§Ù… ØµÙ†Ø¯ÙˆÙ‚/Ø­Ø³Ø§Ø¨</label>
        <input class="inp" id="name" name="name" placeholder="Ù…Ø«Ù„Ø§Ù‹ ØµÙ†Ø¯ÙˆÙ‚ Ø§ØµÙ„ÛŒ ÛŒØ§ Ø¨Ø§Ù†Ú© Ù…Ù„Øª">
      </div>
      <div>
        <label class="lbl" for="kind">Ù†ÙˆØ¹</label>
        <select class="inp" id="kind" name="kind">
          <option value="cash">Ù†Ù‚Ø¯ÛŒ</option>
          <option value="bank">Ø¨Ø§Ù†Ú©ÛŒ</option>
        </select>
      </div>
      <div data-bank-only>
        <label class="lbl" for="bank_name">Ù†Ø§Ù… Ø¨Ø§Ù†Ú©</label>
        <input class="inp" id="bank_name" name="bank_name" placeholder="Ù…Ø«Ù„Ø§Ù‹ Ù…Ù„Øª" />
      </div>
      <div data-bank-only>
        <label class="lbl" for="account_no">Ø´Ù…Ø§Ø±Ù‡ Ø­Ø³Ø§Ø¨</label>
        <input class="inp" id="account_no" name="account_no" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ø­Ø³Ø§Ø¨ ÛŒØ§ Ú©Ø§Ø±Øª" />
      </div>
      <div data-bank-only>
        <label class="lbl" for="iban">Ø´Ø¨Ø§ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</label>
        <input class="inp" id="iban" name="iban" placeholder="IR...">
      </div>
      <div>
        <label class="lbl" for="description">ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
        <input class="inp" id="description" name="description" placeholder="ØªÙˆØ¶ÛŒØ­ Ú©ÙˆØªØ§Ù‡ ÛŒØ§ Ø¢Ø¯Ø±Ø³ Ø´Ø¹Ø¨Ù‡">
      </div>
      <div style="display:flex;gap:10px;">
        <button class="btn btn-primary" type="submit">Ø§ÙØ²ÙˆØ¯Ù† ØµÙ†Ø¯ÙˆÙ‚</button>
      </div>
    </form>
  </div>

  <div class="card" style="display:block;margin-top:18px;">
    <h3 style="margin-top:0;">Ù„ÛŒØ³Øª ØµÙ†Ø¯ÙˆÙ‚â€ŒÙ‡Ø§</h3>
    {% if boxes %}
    <div class="table-responsive">
      <table class="table">
        <thead>
          <tr>
            <th>Ù†Ø§Ù…</th>
            <th>Ù†ÙˆØ¹</th>
            <th>Ø¨Ø§Ù†Ú©</th>
            <th>Ø´Ù…Ø§Ø±Ù‡ Ø­Ø³Ø§Ø¨/Ú©Ø§Ø±Øª</th>
            <th>Ø¬Ù…Ø¹ Ø¯Ø±ÛŒØ§ÙØªÛŒ</th>
            <th>Ø¬Ù…Ø¹ Ù¾Ø±Ø¯Ø§Ø®ØªÛŒ</th>
            <th>Ø®Ø§Ù„Øµ</th>
            <th>ÙˆØ¶Ø¹ÛŒØª</th>
            <th class="center">Ø¹Ù…Ù„ÛŒØ§Øª</th>
          </tr>
        </thead>
        <tbody>
          {% for box in boxes %}
          {% set totals = cash_totals.get(box.id, {'receive':0.0,'payment':0.0}) %}
          <tr class="{{ 'muted' if not box.is_active else '' }}">
            <td>{{ box.name }}</td>
            <td>{{ 'Ø¨Ø§Ù†Ú©ÛŒ' if box.kind=='bank' else 'Ù†Ù‚Ø¯ÛŒ' }}</td>
            <td>{{ box.bank_name or 'â€”' }}</td>
            <td class="ltr">{{ box.account_no or 'â€”' }}</td>
            <td>{{ totals.receive|sep }}</td>
            <td>{{ totals.payment|sep }}</td>
            <td class="{{ 'pos' if totals.receive - totals.payment >= 0 else 'neg' }}">{{ (totals.receive - totals.payment)|sep }}</td>
            <td>{{ 'ÙØ¹Ø§Ù„' if box.is_active else 'ØºÛŒØ±ÙØ¹Ø§Ù„' }}</td>
            <td class="center">
              {% if box.is_active %}
              <form method="post" action="{{ url_for('admin_cashboxes_delete', box_id=box.id) }}" onsubmit="return confirm('Ø­Ø°Ù ÛŒØ§ ØºÛŒØ±ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø§ÛŒÙ† ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù†Ø¬Ø§Ù… Ø´ÙˆØ¯ØŸ');" style="display:inline-block;">
                <button class="btn danger" type="submit" style="padding:6px 12px;">Ø­Ø°Ù/ØºÛŒØ±ÙØ¹Ø§Ù„</button>
              </form>
              {% else %}
                <span class="muted">â€”</span>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
        <tfoot>
          <tr>
            <td colspan="6" style="text-align:left;">Ø¬Ù…Ø¹ Ø®Ø§Ù„Øµ ØµÙ†Ø¯ÙˆÙ‚â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„</td>
            <td colspan="3" class="{{ 'pos' if cash_grand_total >= 0 else 'neg' }}">{{ cash_grand_total|sep }}</td>
          </tr>
        </tfoot>
      </table>
    </div>
    <p class="muted" style="font-size:12px;margin-top:10px;">Ø¯Ø± ØµÙˆØ±Øª Ø§Ø³ØªÙØ§Ø¯Ù‡ ØµÙ†Ø¯ÙˆÙ‚ Ø¯Ø± Ø§Ø³Ù†Ø§Ø¯ Ú¯Ø°Ø´ØªÙ‡ØŒ Ø­Ø°Ù ÙÛŒØ²ÛŒÚ©ÛŒ Ø§Ù†Ø¬Ø§Ù… Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ ØµÙ†Ø¯ÙˆÙ‚ ØºÛŒØ±ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø¯.</p>
    {% else %}
      <div class="muted">Ù‡Ù†ÙˆØ² ØµÙ†Ø¯ÙˆÙ‚ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</div>
    {% endif %}
  </div>
</div>
{% endblock %}

{% block body_scripts %}
{{ super() }}
<script>
(function(){
  const kind = document.getElementById('kind');
  const bankFields = document.querySelectorAll('[data-bank-only]');
  function sync(){
    const isBank = kind && kind.value === 'bank';
    bankFields.forEach(wrap => {
      const input = wrap.querySelector('input');
      if(isBank){
        wrap.style.display = '';
        if(input) input.disabled = false;
      }else{
        wrap.style.display = 'none';
        if(input){ input.value=''; input.disabled = true; }
      }
    });
  }
  if(kind){
    sync();
    kind.addEventListener('change', sync);
  }
})();
</script>
{% endblock %}
